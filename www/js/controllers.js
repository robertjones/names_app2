// Generated by CoffeeScript 1.9.0
(function() {
  angular.module('starter.controllers', []).controller('AppCtrl', function($scope, $ionicPopup, $location, $ionicHistory, Game) {
    return $scope.newGame = function() {
      return $ionicPopup.confirm({
        title: 'End current game?',
        template: 'Are you sure you want to end the current game?',
        cancelText: 'No, play on',
        okType: 'button-assertive',
        okText: 'End game'
      }).then(function(res) {
        if (res) {
          $ionicHistory.nextViewOptions({
            disableAnimate: true,
            disableBack: true
          });
          $location.path('/game');
          return Game.newGame();
        }
      });
    };
  }).controller('GameCtrl', function($scope, $interval, $ionicPopup, Game) {
    var counter, gameOverAlert, goLength, maxSkips, newGameAlert, resetTimer, roundAlert, startTimer, stopTimer, timeRemaining, timer, timerOn, turnEndAlert, turnStartAlert;
    $scope.currentCard = Game.currentCard;
    $scope.skip = Game.skip;
    $scope.foul = Game.foul;
    $scope.got = Game.got;
    $scope.currentTeam = Game.currentTeam;
    $scope.currentRound = Game.currentRound;
    maxSkips = 2;
    $scope.unSkippable = function() {
      return Game.skips >= maxSkips;
    };
    roundAlert = function() {
      stopTimer();
      return $ionicPopup.alert({
        title: Game.currentRound(),
        template: 'Your go continues with a new round.',
        okText: 'Continue'
      }).then(startTimer);
    };
    Game.roundAlert = roundAlert;
    turnEndAlert = function() {
      stopTimer();
      return $ionicPopup.alert({
        title: 'Time\'s up',
        template: (Game.currentTeam().name) + " Team, your turn is over.<br />\nYou got " + Game.turnPoints + " points this turn.<br />\nScores: " + (Game.scoreStr()) + ".",
        okText: 'OK',
        okType: 'button-energized'
      }).then(turnStartAlert);
    };
    Game.turnEndAlert = turnEndAlert;
    turnStartAlert = function() {
      Game.teamSwitch();
      return $ionicPopup.alert({
        title: (Game.currentTeam().name) + " Team, it's your turn",
        template: "It's " + (Game.currentRound()) + ".<br />\nScores: " + (Game.scoreStr()) + ".",
        okText: 'Start turn',
        okType: 'button-balanced'
      }).then(startTimer);
    };
    Game.turnStartAlert = turnStartAlert;
    gameOverAlert = function() {
      stopTimer();
      return $ionicPopup.alert({
        title: 'Game over',
        template: "Scores: " + (Game.scoreStr()) + ".",
        okText: 'Start new game',
        okType: 'button-assertive'
      }).then(function() {
        return Game.newGame();
      });
    };
    Game.gameOverAlert = gameOverAlert;
    newGameAlert = function() {
      stopTimer();
      return $ionicPopup.alert({
        title: 'Get ready',
        template: "<p>Get your teammates to guess as many famous figures and characters as you can before the time runs out; without saying any part of the name shown, or rhyming.</p>\n<p>Once all the names are guessed, a new round begins and you're limited to three, then one, then no words.</p>\n<p>You get two skips per go and you'll need to split into two teams (Green and Blue).</p>\n" + (Game.currentTeam().name) + "'s up - it's " + (Game.currentRound()) + ".",
        okText: 'Start game',
        okType: 'button-balanced'
      }).then(startTimer);
    };
    Game.newGameAlert = newGameAlert;
    goLength = 60;
    timeRemaining = goLength * 10;
    timerOn = true;
    timer = function() {
      if (timerOn) {
        timeRemaining -= 1;
        if (timeRemaining <= 0) {
          timeRemaining = goLength * 10;
          return Game.nextTeam();
        }
      }
    };
    counter = {};
    resetTimer = function() {
      return timeRemaining = goLength * 10;
    };
    Game.resetTimer = resetTimer;
    startTimer = function() {
      timerOn = true;
      return $scope.displayName = true;
    };
    stopTimer = function() {
      timerOn = false;
      return $scope.displayName = false;
    };
    $scope.timePercent = function() {
      return timeRemaining / goLength / 10 * 100;
    };
    $interval(timer, 100);
    $scope.displayName = false;
    return Game.newGame();
  }).controller('NameListsCtrl', function($scope, Game, NameLists) {
    return $scope.namelists = NameLists;
  });

}).call(this);
